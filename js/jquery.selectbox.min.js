!function(e){e.fn.selectbox=function(){e(this).each((function(){var s=e(this);if(s.prev("span.selectbox").length<1){function t(){var t=s.find("option"),o=t.filter(":selected"),l=t.filter(":first").text();o.length&&(l=o.text());var d="";for(i=0;i<t.length;i++){var a="";t.eq(i).is(":selected")&&(a=' class="selected sel"'),t.eq(i).is(":disabled")&&(a=' class="disabled"'),d+="<li"+a+">"+t.eq(i).text()+"</li>"}var c=e('<span class="selectbox" style="display:inline-block;position:relative"><div class="select" style="float:left;position:relative"><div class="text">'+l+'</div><b class="trigger"><i class="arrow"></i></b></div><div class="dropdown" style="position:absolute;z-index:9999;overflow:auto;overflow-x:hidden;list-style:none"><ul>'+d+"</ul></div></span>");s.before(c).css({position:"absolute",top:-9999});var n=c.find("div.select"),r=c.find("div.text"),v=c.find("div.dropdown"),f=v.find("li"),h=c.outerHeight();"auto"==v.css("left")&&v.css({left:0}),"auto"==v.css("top")&&v.css({top:h});var u=f.outerHeight(),p=v.css("top");v.hide(),v.prev().removeClass("active"),n.click((function(){var s=c.offset().top,t=e(window).height()-h-(s-e(window).scrollTop());return t<0||t<6*u?(v.height("auto").css({top:"auto",bottom:p}),v.outerHeight()>s-e(window).scrollTop()-20&&v.height(Math.floor((s-e(window).scrollTop()-20)/u)*u)):t>6*u&&(v.height("auto").css({bottom:"auto",top:p}),v.outerHeight()>t-20&&v.height(Math.floor((t-20)/u)*u)),e("span.selectbox").removeClass("focused"),v.is(":hidden")?(e("div.dropdown:visible").hide(),e("div.select.active").removeClass("active"),v.show(),v.prev().addClass("active")):(v.hide(),v.prev().removeClass("active")),!1})),f.hover((function(){e(this).siblings().removeClass("selected")}));var b=f.filter(".selected").text();f.filter(":not(.disabled)").click((function(){var i=e(this).text();b!=i&&(e(this).addClass("selected sel").siblings().removeClass("selected sel"),t.prop("selected",!1).eq(e(this).index()).prop("selected",!0),b=i,r.text(i),s.change()),v.hide(),v.prev().removeClass("active")})),v.mouseout((function(){v.find("li.sel").addClass("selected")})),s.focus((function(){e("span.selectbox").removeClass("focused"),c.addClass("focused")})).keyup((function(){r.text(t.filter(":selected").text()),f.removeClass("selected sel").eq(t.filter(":selected").index()).addClass("selected sel")})),e(document).on("click",(function(s){e(s.target).parents().hasClass("selectbox")||(v.hide().find("li.sel").addClass("selected"),c.removeClass("focused"),v.prev().removeClass("active"))}))}t(),s.on("refresh",(function(){s.prev().remove(),t()}))}}))}}(jQuery);